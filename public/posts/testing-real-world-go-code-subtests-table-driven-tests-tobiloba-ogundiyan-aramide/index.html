<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Testing Real-World Go Code: Table-Driven Tests, Subtests and Coverage | Tobiloba Ogundiyan</title>
    <link rel="stylesheet" href="/css/root.css">
    <link rel="stylesheet" href="/css/bundle.css">

      <script src="/js/bundle.js"></script><script defer src="/js/search/flexsearch.compact.64594b125f7b78bdf4fa8316955922bbebb1cd6baef3f16654bfca20309f18f8.js" integrity="sha256-ZFlLEl97eL30&#43;oMWlVkiu&#43;uxzWuu8/FmVL/KIDCfGPg="></script>
<script defer src="/js/search/search.1d980f84df11f3eb7c8c5f17f541d49a0611608df179dd74fa7f06225eb56ace.js" integrity="sha256-HZgPhN8R8&#43;t8jF8X9UHUmgYRYI3xed10&#43;n8GIl61as4="></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

</head>
<body class="notransition">
  <div id="container">
    <header id="main-header"><div role="navigation" aria-label="Main">
  <div class="nav-left">
    <a href="http://localhost:1313/" style="color: inherit;">Tobiloba Ogundiyan</a>
  </div>
  <div class="nav-right">
    <div id="nav-dropdown-menu" class="hidden" href="#">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a
      >Projects</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    <a id="nav-dropdown-button" href="#"><svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
    <div id="nav-menu">
    <div class="nav-item">
      <a aria-current="true" class="ancestor" href="/posts/"
      >Posts</a>
    </div>
    <div class="nav-item">
      <a
      >Projects</a>
    </div>
    <div class="nav-item">
      <a href="/about/"
      >About</a>
    </div>
</div>
    <a id="theme-switcher" href="#">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

<svg class="dark-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
  </div>
</div>
</header>
    <div class="flex grow">
      <div id="main-pane">
        <main id="main-content"><div class="single-header">
<ol class="breadcrumbs" itemscope itemtype="https://schema.org/BreadcrumbList">
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/">
        <span itemprop="name">Home</span>
      </a>
      <meta itemprop="position" content='1' />
    </li>
    <span> » </span>
    <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a itemprop="item" href="http://localhost:1313/posts/">
        <span itemprop="name">Posts</span>
      </a>
      <meta itemprop="position" content='2' />
    </li>
    <span> » </span>
</ol>
<h1>Testing Real-World Go Code: Table-Driven Tests, Subtests and Coverage</h1><time datetime="2025-04-04T16:11:10&#43;01:00">April 4, 2025</time><div class="term-container"><div class="tag">
        <a href="http://localhost:1313/tags/go/">#Go</a>
      </div><div class="tag">
        <a href="http://localhost:1313/tags/testing/">#Testing</a>
      </div></ol></div>
  <section class="page-section"><h2 id="introduction">Introduction</h2>
<p>This post walks through testing a Go function that loads a <code>.toml</code> config file into a struct. We&rsquo;ll start by defining the data structure and the <code>LoadConfig</code> function that reads and decodes the file.</p>
<p>create a go file called <code>cfg.go</code> with the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">config</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> (  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Config</span> <span style="color:#66d9ef">struct</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Smtp</span> <span style="color:#a6e22e">Smtp</span>      <span style="color:#e6db74">`toml:&#34;smtp&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Api</span>  <span style="color:#a6e22e">Apifutbol</span> <span style="color:#e6db74">`toml:&#34;api&#34;`</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Smtp</span> <span style="color:#66d9ef">struct</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Server</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`toml:&#34;server&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Port</span>     <span style="color:#66d9ef">int</span>    <span style="color:#e6db74">`toml:&#34;port&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Email</span>    <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`toml:&#34;email&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Password</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`toml:&#34;password&#34;`</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Apifutbol</span> <span style="color:#66d9ef">struct</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Apikey</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`toml:&#34;apikey&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Leagues</span>  []<span style="color:#66d9ef">int</span>  <span style="color:#e6db74">`toml:&#34;leagues&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Teams</span>    []<span style="color:#66d9ef">int</span>  <span style="color:#e6db74">`toml:&#34;teams&#34;`</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Timezone</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`toml:&#34;timezone&#34;`</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>)  
</span></span></code></pre></div><p>The struct models the expected TOML configuration. Next, we’ll implement <code>LoadConfig</code>, which reads the file and decodes it into this struct.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">filename</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>, <span style="color:#66d9ef">error</span>) {  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cfg</span> <span style="color:#a6e22e">Config</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#a6e22e">filename</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">toml</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">data</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cfg</span>, <span style="color:#66d9ef">nil</span>  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>LoadConfig</code> function takes a <code>.toml</code> file path, reads its contents, and unmarshals the data into the <code>Config</code> struct using <code>github.com/BurntSushi/toml</code>. It returns a pointer to the populated struct or an error. Make sure to import both the <code>toml</code>and <code>os</code> packages</p>
<h2 id="testing">Testing</h2>
<p>To test our function, create a new file in the same package called <code>cfg_test.go</code>.
Since <code>LoadConfig</code> reads from the filesystem and parses external data, this qualifies more as an integration test than a pure unit test.
Instead of using a real config file, we&rsquo;ll create a temporary one during the test. The <code>testing</code> package provides utilities like <code>t.TempDir()</code> that create a temporary directory and automatically clean it up afterward.</p>
<p>To prepare for the test, we will:</p>
<ul>
<li>Create a temporary file inside the temp directory</li>
<li>Define TOML data as a string</li>
<li>Write the TOML data to the temporary file</li>
</ul>
<p>Here’s how that looks in code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestLoadConfig</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tempfile</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">TempDir</span>(), <span style="color:#e6db74">&#34;config.toml&#34;</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">`  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[smtp]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server = &#34;smtp.icloud.com&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port = 587  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">email = &#34;apps@icloud.com&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password = &#34;12345&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[api]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apikey = &#34;12345&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">leagues = [11, 22, 33]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">teams = [11, 22, 33]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timezone = &#34;Europe/London&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#a6e22e">tempfile</span>, []byte(<span style="color:#a6e22e">data</span>), <span style="color:#ae81ff">0644</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot write to file: %v&#34;</span>, <span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Next, define the expected output to compare against the result from <code>LoadConfig</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">want</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Config</span>{  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Api</span>: <span style="color:#a6e22e">Apifutbol</span>{  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Apikey</span>:   <span style="color:#e6db74">&#34;12345&#34;</span>,  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Teams</span>:    []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">33</span>},  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Leagues</span>:  []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">33</span>},  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Timezone</span>: <span style="color:#e6db74">&#34;Europe/London&#34;</span>,  
</span></span><span style="display:flex;"><span>    },  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Smtp</span>: <span style="color:#a6e22e">Smtp</span>{  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Server</span>:   <span style="color:#e6db74">&#34;smtp.icloud.com&#34;</span>,  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Port</span>:     <span style="color:#ae81ff">587</span>,  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Email</span>:    <span style="color:#e6db74">&#34;apps@icloud.com&#34;</span>,  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">Password</span>: <span style="color:#e6db74">&#34;12345&#34;</span>,  
</span></span><span style="display:flex;"><span>    },  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Invoke <code>LoadConfig</code> using the temp file and validate the result:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">tempfile</span>)  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;Cannot load config: %v&#34;</span>, <span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">DeepEqual</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">got</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">want</span>) {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;got %v want %v&#34;</span>, <span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">want</span>)  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Once the function is called, we check for an error and compare the result with our expected struct using <code>reflect.DeepEqual</code>
You can now run the test using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>go test
</span></span></code></pre></div><p>It should pass. But let’s go further and check test coverage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>go test -cover
</span></span></code></pre></div><p>This shows the percentage of code covered by tests. You might see something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>coverage: 71.4% of statements
</span></span></code></pre></div><p>This means some parts of the <code>LoadConfig</code> function aren’t being tested; most likely the error paths. To visualize what’s missing, generate a coverage report:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>go test -coverprofile<span style="color:#f92672">=</span>coverage.out
</span></span><span style="display:flex;"><span>go tool cover -html<span style="color:#f92672">=</span>coverage.out
</span></span></code></pre></div><p>This opens a browser view showing exactly which lines aren’t covered. You’ll likely notice that the error branches haven’t been triggered yet.To fix that, we need to add test cases that cover those edge conditions and that’s where subtests come in.</p>
<h2 id="sub-tests">Sub tests</h2>
<p>Rather than writing multiple test functions for the same logic, Go encourages the use of subtests (introduced in Go 1.7). Subtests allow grouping related scenarios within a single test while isolating them for better logging and individual execution.</p>
<p>subtests are written in this format :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) { }
</span></span></code></pre></div><p>it takes a string value as the name and the test package as a parameter to have access to the testing methods.</p>
<p>Now lets refactor our initial tests by adding subtests to it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestLoadConfig</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;valid config&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// we add same  code as before here 	</span>
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p>we can add other edge cases by defining additional sub test in same test function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;No file&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">tempfile</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">TempDir</span>(), <span style="color:#e6db74">&#34;config.toml&#34;</span>)  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">tempfile</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;expected error for missing file, but got nil&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span></code></pre></div><p>now lets add one more edge case for a bad toml data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;invalid toml&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">tempfile</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">TempDir</span>(), <span style="color:#e6db74">&#34;config.toml&#34;</span>)  
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;invalid config&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#a6e22e">tempfile</span>, []byte(<span style="color:#a6e22e">data</span>), <span style="color:#ae81ff">0644</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;failed to write invalid toml file: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">tempfile</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;expected error for invalid toml, but got nil&#34;</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>dont forget to import the necessary packages needed before running the code. Run with the <code>-cover</code> flag. You should now see full coverage. Add more cases if needed.The current test works, but it’s not DRY. Adding more edge cases like this gets repetitive. Let’s fix that next.</p>
<h2 id="table-driven-test">Table Driven Test</h2>
<p>Table-driven tests make tests concise, scalable, and easy to extend. Instead of writing a subtest for each case, we define a slice or map of test cases and loop through them.</p>
<p>lets refactor our code using a table driven style. first, we refactor our test variables into a single var block outside the test function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">validConfig</span> = <span style="color:#e6db74">``</span>  <span style="color:#75715e">// populate values for all from previous code</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">invalidConfig</span> = <span style="color:#e6db74">&#34;&#34;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">want</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Config</span>{}      
</span></span><span style="display:flex;"><span>)  
</span></span></code></pre></div><p>Next, we declare and immediately populate a <code>map[string]struct{}</code> inside our test function. Each key is the test case name, and the value is an anonymous struct that holds the input, expected output, and whether we expect an error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestLoadConfig</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tests</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">struct</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">data</span>        <span style="color:#66d9ef">string</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">want</span>        <span style="color:#f92672">*</span><span style="color:#a6e22e">Config</span>  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">expectError</span> <span style="color:#66d9ef">bool</span>  
</span></span><span style="display:flex;"><span>    }{  
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;valid config&#34;</span>: {<span style="color:#a6e22e">data</span>: <span style="color:#a6e22e">validConfig</span>, <span style="color:#a6e22e">want</span>: <span style="color:#a6e22e">want</span>, <span style="color:#a6e22e">expectError</span>: <span style="color:#66d9ef">false</span>},  
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;No file&#34;</span>:      {<span style="color:#a6e22e">data</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">want</span>: <span style="color:#a6e22e">want</span>, <span style="color:#a6e22e">expectError</span>: <span style="color:#66d9ef">true</span>},  
</span></span><span style="display:flex;"><span>       <span style="color:#e6db74">&#34;Invalid toml&#34;</span>: {<span style="color:#a6e22e">data</span>: <span style="color:#a6e22e">invalidConfig</span>, <span style="color:#a6e22e">want</span>: <span style="color:#a6e22e">want</span>, <span style="color:#a6e22e">expectError</span>: <span style="color:#66d9ef">true</span>},  
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We then loop through each test case using <code>t.Run</code>. For each case, we create a temporary file, write the config data (if any), run <code>LoadConfig</code>, and assert based on the expectation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">tc</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tests</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">name</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {  
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">tempfile</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">filepath</span>.<span style="color:#a6e22e">Join</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">TempDir</span>(), <span style="color:#e6db74">&#34;config.toml&#34;</span>)  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {  
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#a6e22e">tempfile</span>, []byte(<span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">data</span>), <span style="color:#ae81ff">0644</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot write to file: %v&#34;</span>, <span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>             }  
</span></span><span style="display:flex;"><span>          }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">tempfile</span>)  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">expectError</span> {  
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;expected an error but got nil&#34;</span>)  
</span></span><span style="display:flex;"><span>             }  
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {  
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;did not expect error, got: %v&#34;</span>, <span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>             }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">DeepEqual</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">got</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">want</span>) {  
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;got %v want %v&#34;</span>, <span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">want</span>)  
</span></span><span style="display:flex;"><span>             }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          }  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>       })  
</span></span><span style="display:flex;"><span>    }  
</span></span></code></pre></div><p>Our tests now look much cleaner than before. We’ve eliminated multiple <code>t.Run</code> blocks and moved everything into a single loop.
However, we still have too many <code>if</code> statements, which hurts readability. We can improve this further using the <code>assert</code> and <code>require</code> helpers from the <code>testify</code> package.To do this, import:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#e6db74">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;github.com/stretchr/testify/require&#34;</span>
</span></span></code></pre></div><p>Then, initialize them just before the <code>tests</code> variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">assert</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">t</span>)  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">require</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">require</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">t</span>)
</span></span></code></pre></div><p>now lets swap out the if statements using our new helper methods</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#a6e22e">tempfile</span>, []byte(<span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">data</span>), <span style="color:#ae81ff">0644</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {  
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">require</span>.<span style="color:#a6e22e">Nil</span>(<span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>    }  
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">got</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">LoadConfig</span>(<span style="color:#a6e22e">tempfile</span>)  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">expectError</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">require</span>.<span style="color:#a6e22e">NotNil</span>(<span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">require</span>.<span style="color:#a6e22e">Nil</span>(<span style="color:#a6e22e">err</span>)  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">got</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">tc</span>.<span style="color:#a6e22e">want</span>)  
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The test should still run as normal, and coverage should remain 100%. You can run <code>go test -cover</code> to verify.</p>
<h2 id="summary">Summary</h2>
<p>Our tests are now cleaner, easier to read, and more scalable.<br>
Together, we’ve covered:</p>
<ul>
<li>How to write integration-style config file tests in Go</li>
<li>How to handle edge cases using subtests</li>
<li>How to structure and simplify tests with table-driven style</li>
<li>How to improve test readability using <code>testify</code></li>
</ul>
<p>— Tobiloba  Ogundiyan</p>
</section></main>
        <footer id="main-footer"><div class="footer">
  <a href="#">Scroll to Top</a>
  <div class="footer-copyright">
    <div>© 2025 Tobiloba Ogundiyan</div>
    <div>Made with ❤️ and powered by <a href="https://github.com/math-queiroz/rusty-typewriter" target="_blank">Rusty Typewriter</a> theme for <a href="https://gohugo.io/" target="_blank">Hugo</a></div>
  </div>
</div>
</footer>
      </div><aside id="side-pane" class="side-sticky"><div class="side-details">
    <span>1282 words</span>
    <span>8 - 11 minutes read</span><div class="side-details-taxonomy">
        <small>series: 
          <span class="details-taxonomy"><a href="http://localhost:1313/series/testing-in-go">testing-in-go</a></span></small>
      </div></div><h3>Table Of Contents</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#testing">Testing</a></li>
    <li><a href="#sub-tests">Sub tests</a></li>
    <li><a href="#table-driven-test">Table Driven Test</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></aside></div>
  </div>
</body>
</html>
